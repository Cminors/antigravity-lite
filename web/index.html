<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity Lite</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app">
        <nav class="sidebar">
            <div class="logo">
                <span class="logo-icon">ğŸš€</span>
                <span class="logo-text">Antigravity Lite</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="accounts">
                    <span class="nav-icon">ğŸ”</span>
                    <span>Accounts</span>
                </li>
                <li class="nav-item" data-page="routes">
                    <span class="nav-icon">ğŸ›¤ï¸</span>
                    <span>Model Router</span>
                </li>
                <li class="nav-item" data-page="logs">
                    <span class="nav-icon">ğŸ“</span>
                    <span>Logs</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Settings</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Running</span>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <!-- Dashboard -->
            <div id="page-dashboard" class="page active">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <button class="btn btn-primary" onclick="refreshDashboard()">
                        <span>ğŸ”„</span> Refresh
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ”</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-accounts">-</span>
                            <span class="stat-label">Total Accounts</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-active">-</span>
                            <span class="stat-label">Active Accounts</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“¤</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-requests">-</span>
                            <span class="stat-label">Today Requests</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âš¡</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-latency">-</span>
                            <span class="stat-label">Avg Latency</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <h3>Model Stats</h3>
                        <div id="model-stats" class="stats-list"></div>
                    </div>
                    <div class="card">
                        <h3>API Endpoints</h3>
                        <div class="endpoint-list">
                            <div class="endpoint-item">
                                <span class="endpoint-method">POST</span>
                                <code>/v1/chat/completions</code>
                                <span class="endpoint-label">OpenAI</span>
                            </div>
                            <div class="endpoint-item">
                                <span class="endpoint-method">POST</span>
                                <code>/v1/messages</code>
                                <span class="endpoint-label">Anthropic</span>
                            </div>
                            <div class="endpoint-item">
                                <span class="endpoint-method">GET</span>
                                <code>/v1/models</code>
                                <span class="endpoint-label">Models</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <div class="card chart-card">
                        <h3>ğŸ“ˆ 24å°æ—¶è¯·æ±‚è¶‹åŠ¿</h3>
                        <div class="chart-container">
                            <canvas id="hourlyChart"></canvas>
                        </div>
                    </div>
                    <div class="card chart-card">
                        <h3>ğŸ¥§ æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒ</h3>
                        <div class="chart-container">
                            <canvas id="modelChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accounts -->
            <div id="page-accounts" class="page">
                <div class="page-header">
                    <h1>Accounts</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="checkAllAccounts()">
                            <span>ğŸ”</span> Check All
                        </button>
                        <button class="btn btn-secondary" onclick="exportAccounts()">
                            <span>ğŸ“¤</span> Export
                        </button>
                        <button class="btn btn-primary" onclick="showAddAccountModal()">
                            <span>â•</span> æ·»åŠ è´¦å·
                        </button>
                        <button class="btn btn-secondary" onclick="refreshAllQuotas()">
                            <span>ğŸ”„</span> åˆ·æ–°é…é¢
                        </button>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <input type="text" id="account-search" placeholder="ğŸ” æœç´¢é‚®ç®±..." onkeyup="filterAccounts()">
                    <div class="filter-tabs">
                        <button class="filter-tab active" data-filter="all">å…¨éƒ¨ <span class="count"
                                id="count-all">0</span></button>
                        <button class="filter-tab" data-filter="pro">PRO <span class="count"
                                id="count-pro">0</span></button>
                        <button class="filter-tab" data-filter="ultra">ULTRA <span class="count"
                                id="count-ultra">0</span></button>
                        <button class="filter-tab" data-filter="free">FREE <span class="count"
                                id="count-free">0</span></button>
                    </div>
                </div>

                <div class="card">
                    <table class="data-table accounts-table">
                        <thead>
                            <tr>
                                <th style="width:30px">â‹®â‹®</th>
                                <th>é‚®ç®±</th>
                                <th>æ¨¡å‹é…é¢</th>
                                <th>æœ€åä½¿ç”¨</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="accounts-table">
                            <tr>
                                <td colspan="5" class="loading">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Model Router -->
            <div id="page-routes" class="page">
                <div class="page-header">
                    <div class="page-title-section">
                        <h1>ğŸ›¤ï¸ æ¨¡å‹è·¯ç”±ä¸­å¿ƒ (Model Router)</h1>
                        <p class="page-subtitle">é€šè¿‡é€šé…ç¬¦æˆ–ç²¾ç¡®æ˜ å°„è‡ªå®šä¹‰æ¨¡å‹è·¯ç”±è§„åˆ™</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="applyPresetMappings()">
                            <span>âœ¨</span> åº”ç”¨é¢„è®¾æ˜ å°„
                        </button>
                        <button class="btn btn-secondary" onclick="resetMappings()">
                            <span>ğŸ”„</span> é‡ç½®æ˜ å°„
                        </button>
                        <button class="btn btn-primary" onclick="saveRoutes()">
                            <span>ğŸ’¾</span> ä¿å­˜
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="section-header">
                        <h3>â–¸ è‡ªå®šä¹‰æ˜ å°„ (CUSTOM MAPPINGS)</h3>
                    </div>
                    <p class="section-subtitle">å½“å‰æ˜ å°„åˆ—è¡¨ (CUSTOM LIST)</p>
                    <div id="routes-container" class="mappings-grid"></div>
                    <button class="btn btn-secondary" onclick="addRouteRow()" style="margin-top: 1rem;">
                        <span>â•</span> æ·»åŠ æ˜ å°„
                    </button>
                </div>

                <div class="card" style="margin-top: 1rem;">
                    <h3>å¯ç”¨æ¨¡å‹</h3>
                    <div class="preset-models">
                        <span class="model-tag">gemini-2.5-flash</span>
                        <span class="model-tag">gemini-2.5-pro</span>
                        <span class="model-tag">gemini-2.0-flash</span>
                        <span class="model-tag">gemini-2.0-pro</span>
                        <span class="model-tag">claude-sonnet-4-5</span>
                        <span class="model-tag">claude-opus-4-5-thinking</span>
                    </div>
                </div>
            </div>

            <!-- Logs -->
            <div id="page-logs" class="page">
                <div class="page-header">
                    <h1>Request Logs</h1>
                    <button class="btn btn-primary" onclick="refreshLogs()">
                        <span>ğŸ”„</span> Refresh
                    </button>
                </div>

                <div class="card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Account</th>
                                <th>Model</th>
                                <th>Tokens (In/Out)</th>
                                <th>Latency</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="logs-table">
                            <tr>
                                <td colspan="6" class="loading">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings -->
            <div id="page-settings" class="page">
                <div class="page-header">
                    <div class="page-title-section">
                        <h1>âš™ï¸ æœåŠ¡é…ç½®</h1>
                        <span class="service-status" id="service-status">â— æœåŠ¡è¿è¡Œä¸­ (0 ä¸ªè´¦å·)</span>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="openMonitor()">
                            <span>ğŸ“Š</span> æ‰“å¼€ç›‘æ§
                        </button>
                        <button class="btn btn-danger" onclick="toggleService()" id="btn-toggle-service">
                            <span>â¹</span> åœæ­¢æœåŠ¡
                        </button>
                    </div>
                </div>

                <!-- Service Config Card -->
                <div class="card config-card">
                    <div class="config-grid">
                        <div class="config-item">
                            <label>ç›‘å¬ç«¯å£ <span class="info-icon" title="é»˜è®¤ 8045ï¼Œä¿®æ”¹ç«¯å£éœ€é‡å¯æœåŠ¡">â“˜</span></label>
                            <input type="number" id="config-port" value="8045" min="1000" max="65535">
                            <p class="config-hint">é»˜è®¤ 8045ï¼Œä¿®æ”¹ç«¯å£éœ€é‡å¯æœåŠ¡</p>
                        </div>
                        <div class="config-item">
                            <label>è¯·æ±‚è¶…æ—¶ <span class="info-icon" title="èŒƒå›´ 30-3600 ç§’">â“˜</span></label>
                            <div class="input-with-suffix">
                                <input type="number" id="config-timeout" value="120" min="30" max="3600">
                                <span class="suffix">ç§’</span>
                            </div>
                            <p class="config-hint">é»˜è®¤ 120 ç§’ï¼ŒèŒƒå›´ 30-3600 ç§’ï¼Œä¿®æ”¹åéœ€é‡å¯æœåŠ¡ç”Ÿæ•ˆ</p>
                        </div>
                        <div class="config-item">
                            <label class="toggle-label">
                                <span>è·Ÿéšåº”ç”¨è‡ªåŠ¨å¯åŠ¨ <span class="info-icon">â“˜</span></span>
                                <label class="toggle">
                                    <input type="checkbox" id="config-autostart" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                    </div>

                    <div class="config-row">
                        <div class="config-item">
                            <label>å…è®¸å±€åŸŸç½‘è®¿é—® <span class="info-icon">â“˜</span></label>
                            <label class="toggle">
                                <input type="checkbox" id="config-lan-access">
                                <span class="toggle-slider"></span>
                            </label>
                            <p class="config-hint">ğŸ”’ ä»…ç›‘å¬ 127.0.0.1ï¼Œä»…æœ¬æœºå¯è®¿é—®ï¼ˆéšç§ä¼˜å…ˆï¼‰</p>
                            <p class="config-hint warning">âš  éœ€è¦é‡å¯æœåŠ¡åç”Ÿæ•ˆ</p>
                        </div>
                        <div class="config-item">
                            <label>è®¿é—®æˆæƒ <span class="info-icon">â“˜</span></label>
                            <div class="auth-config">
                                <span>å·²å¯ç”¨</span>
                                <label class="toggle">
                                    <input type="checkbox" id="config-auth-enabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>æ¨¡å¼</label>
                                <select id="config-auth-mode">
                                    <option value="open">å…³é—­ï¼ˆå¼€æ”¾ï¼‰</option>
                                    <option value="bearer">Bearer Token</option>
                                </select>
                            </div>
                            <p class="config-hint">å¼€å¯åå®¢æˆ·ç«¯éœ€é€šè¿‡ Authorization: Bearer ... ä¼ å…¥ API å¯†é’¥</p>
                        </div>
                    </div>

                    <div class="api-key-section">
                        <label>API å¯†é’¥ <span class="info-icon">â“˜</span></label>
                        <div class="api-key-display">
                            <code id="api-key-value">sk-xxxxxxxxxxxxxxxxxxxxx</code>
                            <button class="btn btn-sm btn-secondary" onclick="refreshApiKey()">
                                <span>ğŸ”„</span>
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="copyApiKey()">
                                <span>ğŸ“‹</span>
                            </button>
                        </div>
                        <p class="config-hint warning">æ³¨æ„ï¼šè¯·å¦¥å–„ä¿ç®¡æ‚¨çš„ API å¯†é’¥ï¼Œä¸è¦æ³„éœ²ç»™ä»–äººã€‚</p>
                    </div>
                </div>

                <!-- Scheduling Mode Card -->
                <div class="card config-card" style="margin-top: 1rem;">
                    <div class="scheduling-header">
                        <h3>è°ƒåº¦æ¨¡å¼ <span class="info-icon">â“˜</span></h3>
                        <button class="btn btn-sm btn-secondary" onclick="clearSessionBinding()">
                            <span>ğŸ—‘ï¸</span> æ¸…é™¤ä¼šè¯ç»‘å®š
                        </button>
                    </div>

                    <div class="scheduling-content">
                        <div class="schedule-modes">
                            <label class="mode-option">
                                <input type="radio" name="schedule-mode" value="cache">
                                <div class="mode-card">
                                    <strong>ç¼“å­˜ä¼˜å…ˆ (Cache First)</strong>
                                    <p>ç»‘å®šä¼šè¯ä¸è´¦å·ï¼Œé™æµæ—¶ç»§ç»­ç­‰å¾…ï¼ˆæœ€å¤§åŒ– Prompt Cache å‘½ä¸­ç‡ï¼‰ã€‚</p>
                                </div>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="schedule-mode" value="balance" checked>
                                <div class="mode-card active">
                                    <strong>å¹³è¡¡è½®æ¢ (Balance)</strong>
                                    <p>ç»‘å®šä¼šè¯ï¼Œé™æµæ—¶è‡ªåŠ¨çƒ­åˆ‡æ¢è‡³å¯ç”¨è´¦å·ï¼ˆå…¼é¡¾ç¼“å­˜ä¸å¯ç”¨æ€§ï¼‰ã€‚</p>
                                </div>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="schedule-mode" value="performance">
                                <div class="mode-card">
                                    <strong>æ€§èƒ½ä¼˜å…ˆ (Performance)</strong>
                                    <p>æ— ä¼šè¯ç»‘å®šï¼Œçº¯éšæœºè½®æ¢ï¼ˆé€‚åˆé«˜å¹¶å‘ï¼Œä¸è€ƒè™‘ç¼“å­˜ï¼‰ã€‚</p>
                                </div>
                            </label>
                        </div>

                        <div class="wait-time-section">
                            <label>æœ€å¤§ç­‰å¾…æ—¶é•¿ (ç§’) <span class="info-icon">â“˜</span></label>
                            <div class="slider-container">
                                <input type="range" id="config-wait-time" min="0" max="300" value="60"
                                    oninput="updateWaitTimeDisplay(this.value)">
                                <span class="slider-value" id="wait-time-value">60s</span>
                            </div>
                            <div class="slider-labels">
                                <span>0s</span>
                                <span>300s</span>
                            </div>
                            <p class="config-hint info">ğŸ’¡ æç¤ºï¼šé’ˆå¯¹å…¨åè®®å®¢æˆ·ç«¯ä¼˜åŒ– Prompt Caching å’Œé™æµå¤„ç† (OpenAI/Gemini/Claude)ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="settings-footer">
                    <button class="btn btn-primary btn-lg" onclick="saveConfig()">
                        <span>ğŸ’¾</span> ä¿å­˜è®¾ç½®
                    </button>
                </div>

                <!-- Usage Examples -->
                <div class="card" style="margin-top: 1rem;">
                    <h3>ä½¿ç”¨ç¤ºä¾‹</h3>
                    <div class="code-block">
                        <p><strong>Python (OpenAI SDK):</strong></p>
                        <pre><code>from openai import OpenAI

client = OpenAI(
    base_url="http://127.0.0.1:8045/v1",
    api_key="your-api-key"
)

response = client.chat.completions.create(
    model="claude-sonnet-4-5",
    messages=[{"role": "user", "content": "Hello"}]
)

print(response.choices[0].message.content)</code></pre>
                    </div>
                    <div class="code-block">
                        <p><strong>Claude CLI:</strong></p>
                        <pre><code>export ANTHROPIC_API_KEY="your-api-key"
export ANTHROPIC_BASE_URL="http://127.0.0.1:8045"
claude</code></pre>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Account Modal (Multi-tab) -->
    <div id="modal-add-account" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>æ·»åŠ æ–°è´¦å·</h2>
                <button class="modal-close" onclick="closeModal('modal-add-account')">&times;</button>
            </div>
            <div class="modal-tabs">
                <button class="modal-tab" data-tab="oauth" onclick="switchAccountTab('oauth')">OAuth æˆæƒ</button>
                <button class="modal-tab active" data-tab="token" onclick="switchAccountTab('token')">Refresh
                    Token</button>
                <button class="modal-tab" data-tab="database" onclick="switchAccountTab('database')">ä»æ•°æ®åº“å¯¼å…¥</button>
            </div>
            <div class="modal-body">
                <!-- OAuth Tab -->
                <div class="tab-content" id="tab-oauth">
                    <div class="oauth-section">
                        <p class="info-text">é€šè¿‡ Google OAuth æˆæƒè·å– Refresh Token</p>
                        <button class="btn btn-primary btn-lg" onclick="startOAuthFlow()">
                            <span>ğŸ”</span> å¼€å§‹ OAuth æˆæƒ
                        </button>
                        <p class="config-hint">éœ€è¦é…ç½® GOOGLE_CLIENT_ID å’Œ GOOGLE_CLIENT_SECRET ç¯å¢ƒå˜é‡</p>
                    </div>
                </div>

                <!-- Token Tab -->
                <div class="tab-content active" id="tab-token">
                    <div class="form-group">
                        <label>Refresh Token</label>
                        <textarea id="account-token" rows="6" placeholder="åœ¨æ­¤å¤„ç²˜è´´æ‚¨çš„ Refresh Tokenï¼ˆæ”¯æŒæ‰¹é‡ï¼‰"></textarea>
                    </div>
                    <div class="token-formats">
                        <p class="hint-title">æ”¯æŒæ ¼å¼ï¼š</p>
                        <ol class="format-list">
                            <li>å•ä¸ª Token (1//...)</li>
                            <li>JSON æ•°ç»„ï¼ˆå« refresh_token å­—æ®µï¼‰</li>
                            <li>ä»»æ„åŒ…å« Token çš„æ–‡æœ¬ï¼ˆè‡ªåŠ¨æå–ï¼‰</li>
                        </ol>
                    </div>
                    <p class="config-hint info">ğŸ’¡ æç¤ºï¼šæ”¯æŒä¸€æ¬¡æ€§ç²˜è´´å¤šä¸ª Token æˆ– JSON æ•°ç»„ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶æ‰¹é‡å¯¼å…¥ã€‚</p>

                    <div class="form-group" style="margin-top: 1rem;">
                        <label>è´¦å·ç±»å‹ï¼ˆå¯é€‰ï¼‰</label>
                        <select id="account-type">
                            <option value="free">Free</option>
                            <option value="pro">Pro</option>
                            <option value="ultra">Ultra</option>
                        </select>
                    </div>
                </div>

                <!-- Database Tab -->
                <div class="tab-content" id="tab-database">
                    <div class="form-group">
                        <label>æ•°æ®åº“ç±»å‹</label>
                        <select id="db-type">
                            <option value="sqlite">SQLite</option>
                            <option value="mysql">MySQL</option>
                            <option value="postgres">PostgreSQL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¿æ¥å­—ç¬¦ä¸²</label>
                        <input type="text" id="db-connection"
                            placeholder="ä¾‹å¦‚: ./accounts.db æˆ– user:pass@tcp(host:3306)/dbname">
                    </div>
                    <div class="form-group">
                        <label>è¡¨å</label>
                        <input type="text" id="db-table" placeholder="accounts" value="accounts">
                    </div>
                    <button class="btn btn-secondary" onclick="testDbConnection()">
                        <span>ğŸ”Œ</span> æµ‹è¯•è¿æ¥
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-add-account')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="addAccountFromModal()">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="app.js"></script>
</body>

</html>